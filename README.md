# Stock Price By Financials:  Создание модели для определения стоимости акции на основе финансовых показателей компании

## Введение

### Цель и основная идея работы

Идея данного проэкта является создания модели машинного обучения для определенния истинной стоимости компании. На рынке ценных бумаг часто можно заметить акции, цена которых значительно изменяется в течении непродолжительного временного промежутка, обычно это связано с объективными и значительными изменениями в бизнесе компании, тем не менее не редки случаи когда акция компании получает черезмерную или недостаточную популярность, вовремя замеченые такие акции являются идеальным вложением с перспективой на время, когда другие инвесторы так же заметят переоцененность или недооцененность акций. Поиск именно таких (недооценынных или же переоцененных) акций с помощью моделей машинного обучения является основной целью данной работы.

### Тестирование моделей
Тестирование и подбор лучших моделей будет проходить в способ "псевдо" инвестирования в акции (на срок в 1 год), цена которых модель посчитала необъективной, после чего программа учтёт изменение цен акций на следующий год и получит годовой доход этой модели. И в конце, записав результаты всех моделей во всех секторах, а так же определив из них 7 наилучших, создать список инвестиций каждой модели на 2024 год.

### Возможность реализации

   В реализации проета есть несколько неоднозначных моментов которые следует учитывать.

1. Основная цель обучении модели состоит в сопоставлении финансовых показателей компании с ценой ее акции, таким образом в лучшем случае модель в состоянии найти акцию, цена которой значительно отличается от других акций, при этом имея схожее с ними финансовое положение. Таким образом модель не в состоянии показать степень перегретости рынка и принимает цены акций на рынке как объективный показатель, пытаясь найти акции цена которых выделяется.
   
2. К большому сожалению сайт finance.yahoo предостовляет только 4 последних финансовых отчетностей, в связи с этим в проекте точность модели определяется только по краткосрочным инвестициям (1 год).  
   
3. Данные в проекте актуальны только на 2024 год, в последующем желательно обновить данные и возможно определить новые наилучшие модели.

## Выполнение проекта

### Сбор данных

1. Для обучения и тестирования моделей нужно получить доступ к ценам и финансовым отчетностям компаний. Для этого был использован сервис finance.yahoo, а также библиотека YFinance. Для начала стоило определить какие именно компании стоит использовать для обучения, для этого на сайте macrotrends были спарсены тикеры всех действующих компаний а также секторы их деятельности(All_lists).(data_collect.py)

2. После получения списков секторов с тикерами соответствующих компаний, используя yfinance были сформированны новые базы данных для фин. отчетностей компаний (All_lists_collected). Так же во время сбора данных компаний были написаны несколько функций для отсеивания нерелевантных данных.(main.py)

### Обучение моделей

Для выполнения этого проекта были выбраны 7 алгоритмов машинного обучения: **BayesianRidge**, **ElasticNet**, **Random Forest**, **XgBoosting**, **Gradient Boosting**, **CatBoosting**,  **Neural Network**, для большей ефективности обучения была использована optuna для подбора наилучших гиперпараметров моделей, ефективность модели определяется процентной разницей между предсказанной и фактической ценой акции.

### Предварительная обработка данных

Во время предварительной обработки данных у нас имеется набор из множества различных елементов финансовой отчетности, для обучения модели требуется одинаковая размерность данных, для этого нужно удалить те компании в данных которых много пробелов, а так же заполнить пропуски оставшихся, для 1 задачи были использованы 2 коэфициента (являются одними из гиперпараметров optuna) которые отвечали за допустимое количество пропусков в елементах фин. отчетности и в данных самих компаний, для заполнения оставшихся пропусков была использована линейная регрессию.

Для поиска наиболее подходящих елементов фин. отчетности была использована корреляцию между ними и ценой акции и отсортировал значение по модулю, количество наиболее коррелирующих данных определять гиперпараметр nlarge.

Наконец, можно приступать к обучению самих моделей и подбору наилучших гиперпараметров. После определения наиболее точных моделей можно использовать их для определения точности инвестирования.

### Псевдо инвестирование

Когда наиболее точные модели получены можно приступать к псевдо инвестированию, суть состоит в том что бы в определенном секторе модель предсказала цены всех компаний и если их настоящая цена меньше предсказаной на определенный процент (гиперпараметр) то скрипт якобы покупает n количество акций, после чего сравнивает с ценой на следующий год и получает прибыль или убыток в зависимости от точности предсказания. Тоже самое работает наооборот (на шортовую позицию).

После того как подобраны лучшие гиперпараметры для псевдо инвестирования (процент скидки, рынок инвестирования (только бычий или включая медвежий)) скрипт записывает лучшие модели, а также их гиперпараметры в файл. 

Также для большей достоверности результатов скрипт запускается еще раз только с даными за предпоследний год. В результате у нас есть результаты моделей а также 2 годовых дохода от всевдо инвестиций. На основе всех полученых данных была составлена таблица.

##  Итоги
На данном этапе работа выполнена и пора подводить итоги:
### Таблица итогов

Заполненая таблица с результатами всех моделей находится в файле **Models_Results.xlsx**.
Стоит отдельно отметить 7 наилучших моделей
![Top7](https://github.com/Kertn/Stock_Price_by_Financials/assets/111581848/966c5ecc-c2d1-4fa1-b20d-e7273af68278)

1 колона - Сектор инвестиций\
2 колона - Модель\
3 колона - Годовой доход модели\
4 колона - Количество купленых акций различных компаний\
5 колона - Количество доступных акций различных компаний\
6 колона - Годовой доход модели (Предпоследний год)\
7 колона - Количество купленых акций различных компаний(Предпоследний год)\
8 колона - Количество доступных акций различных компаний(Предпоследний год)\
9 колона - Процентная разница между предсказанной ценой акции и фактической (Точность определения цена акции (100% - min))\
10 колона - Рынок инвестиций\
11 колона - Скидка для цены акции\
12 колона - Параметры модели\

### Инвестирование

Что касается использование 7 лучших моделей для инвестиций в 2024 году, то лучше всего себя показывает (Medical Multi-Sector Conglomerates, CatBoost) на момент 22.04.2024 доход модели составляет 36.8%\
Далее с 1% доходностью идет (Full_list, Random_Forest)\
Хуже всего показатели у (Transportation, Neural Network) - 26.2%\
В целом на данный момент 5 из 7 моделей имеют от -11% до -26%

### Выводы
**В связи с количеством неудачных инвестиций с начала 2024 года на данный момент стоит скептически отноститься к применению моделей для покупки акций, как минимум стоит узнать их доходность в предстоящем 2024, а лучше и в 2025 году. Тем не менее предсказания моделей хорошо подходят для дополнительного анализа наиболее недооцененных (по мнению модели) компаний, лучше всего по сравнению с остальными с этим справляться CatBosting.**

